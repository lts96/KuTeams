일단 목표 :  1대 다 채팅 , 1대다 화면전송 2개 잘 돌아가게 만들기  -  성공

현재 - 로그인은 가능 

클라이언트에서 서버로 메세지 전송 가능 
문제는 서버 버퍼가 오버플로우 생길 수도 있음 -> 예의 주시

클라이언트에서 왜 리시브 못하는지 알아냄 
클라이언트 selector 가 별도의 쓰레드로 존재하는게 아니라서 ui 처리에 막혀서 작동 못하고 있었음 
-> ui 를 별도의 쓰레드를 줘서 돌리던가 아니면 selector를 따로 쓰레드 분리해서 돌려야됨 


버그 리포트 

이미 방에 접속한 클라이언트가 방에서 안나간 상태에서 또 접속하면 한 클라이언트가 인구수 2를 차지 
-> 이미 방에 접속한 클라이언트는 방에서 안나가면 다시 못들어오도록 처리해야됨 
-> 처리 완료 (일단은 이상없음 )

클라이언트 9개 돌리니까 속도 느려지는 문제 -> 리시브 블로킹으로 바꾸니 해결됨 
논블로킹인데 selector 이상하게 해놔서 계속 recv가 무한루프돌고 있었음

중요 문제점 
이미지를 전송하고 싶은데 논블로킹으로 서버를 구현해놔서 stream 사용 불가능 
image를 안전하게 전송하는 방법은 outputstream과 inputstream을 사용하는 것 

만약 이렇게 하려면 서버를 멀티 쓰레드로 구현해서 클라이언트마다 쓰레드 연결해서 데이터 주고 받는 수밖에 없음

UDP로 하려고 해도 여러 클라이언트에서 동시에 server 쪽 UDP에 접근한다면?   그리고 UDP는 datagram 용량이 6kb 정도라서 
메가 바이트 단위인 이미지 전송에 부적합 -> 중간에 값이 겹쳐진다던가 할 가능성이 높다고 판단됨. 

생각해본 해결방법
1. 싹 갈아엎고 서버를 멀티쓰레드로 짠 다음 stream 사용 
2. UDP로 안전하게 이미지 파일 전송할 방법 찾기 
3. 논블로킹 버퍼를 이용해서 image 정보를 쪼개서 보낸다음 클라이언트 쪽에서 합쳐서 재생? 

한번에 read하는 바이트 용량 문제 였음 png 포맷으로 바꾸니 바이트 수 현저하게 감소 -> 4만 바이트 근처 
그래서 현재 서버로 이미지 전송 완료  -> 전송된 이미지의 용량은 이상없음 
대신 print 가 출력이 안되는 버그 발생 -> 해결할 것 
그리고 버퍼 문제 아직 제대로 해결된거 아님 

발표 전날에 깃허브 private -> public 으로 변환하기 

클라이언트 -> 서버 -> 클라이언트로 이미지 전송 성공 

그런데 문제점 -> 이미지가 갱신이 안됨 (전송은 하고 있음 , 받는 쪽 문제)
그리고 전송하는 쪽도 while 돌리면 굳어버림 -> 계속 전송만 함 
따로 쓰레드 생성해야될듯 

따로 쓰레드 생성한 결과 -> 일단 1대1에서 화면 전송이 되는 것을 확인 (대신 모니터를 한번 껐다켜야 제대로 동작 왜???)
대신 한번 실행하고 나서 서버가 제대로 안열림 -> 쓰레드 종료가 제대로 안되서 그런걸로 추정 

클라이언트 연결 끊어지면 서버 죽는 버그 수정 + 클라이언트 나갈시 로그아웃 처리 , 재접속 가능하게 해둠 

버그 리스트 

1 . 이미지 전송하는 쪽에서 채팅칠때 이미지 전송 속도가 현저하게 느려짐(일단 보낸 메세지 print를 멈추니 조금 나아짐)
가설 1 : 이미지 전송과 메세지 전송이 같은 sender 객체를 쓰고있어서 느려졌다. -> sender를 여러개 만들어도 똑같음 
아마 서버에서 처리하는게 늦는듯
그리고 이미지를 한번 전송하고 나면 그다음엔 채팅이 좀 느려짐  (클라이언트쪽 받은 값 콘솔 출력하는 코드 다 지우니까 좀 빨라짐)
1대 1 화면 공유 가능 

2.  2명이 방송 키고 있으면 받는 쪽에서 양쪽 화면을 다 받음 -> 이거 고치면 1대1 화면 공유가 안될 수도 

3. 서버 죽으면 클라 다죽음 

4. 카메라가 너무 빨리 움직이면 캡처가 제대로 안되서 널포인트 에러뜸 -> 이건 어쩔수 없을듯 (대신 천천히 움직이면 제대로 됨)

5. 방송중 채팅을 빨리 치면 가아끔 메세지가 사라짐 -> 전송하기 전에 버퍼가 덧씌워지는거 같다. -> 이건 속도 개선하니 좀 나아짐  

6. 이상하게 모니터는 꼭 2번 켜야 제대로 출력된다 --> 왜??? 

7. 이미지 파일 포맷 바꿨을때 실험 결과 

8. 방 나갈때 코드 잘못 넣어서 버그 났었음 -> 수정 : 방 나가면 서버쪽에서 해당 클라이언트의 방 코드를 -1 로 바꿔줌 
자세한건 exitRoom 함수 참고 
이거 수정하고 나선 에러 안보임 , 일단 이전과 같이 작동 되지만 혹시 모르니 주의할 것 

bmp -> 압축이 거의 안됨 -> 메가 바이트 단위 -> 속도 엄청 느림 
png -> 대략 40kb 단위 -> 속도 그덕저럭    현재 png 로 하고 있음 
jpg -> 40~ 60 kb 단위 -> 속도는 png 랑 비슷 (조금 더 빠른거 같기도 한데 애매함)


구현해야될 추가 기능들      지금 라인수 1800 정도    서버 700 클라 300 ui + ui 쪽 연산 800 (클라 기능이 ui로 분산되어있기 때문)
방 리스트에서 현재 인원 갱신  -> update 버튼 누르면 정상적으로 갱신됨 -> 대신 실시간 갱신은 안됨 
방 입장했을때 지금 방에 있는 인원 출력      -> 완성됨 -> 버그 있나 테스트하면서 확인해볼것 
회원가입 
초대하기? 
이모티콘? 




